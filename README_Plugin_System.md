# ILLUSION CDN Server - Система плагинов

## Описание

Сервер ILLUSION CDN теперь поддерживает динамическую систему плагинов, которая позволяет автоматически загружать и регистрировать плагины при запуске сервера.

## Структура проекта

```
/
├── server.py                 # Основной сервер с системой плагинов
├── app.py                   # Старый файл (теперь не используется)
├── config/
│   └── github_repo.json    # Конфигурация GitHub репозиториев
└── plugin/                  # Директория плагинов
    ├── GitHub/              # Плагин для работы с GitHub
    │   ├── plugin.cfg       # Конфигурация плагина
    │   └── github.py        # Основной файл плагина
    ├── ILL/                 # Плагин для .ill файлов
    │   ├── plugin.cfg
    │   ├── ILL.py
    │   └── rq.txt
    └── TTS/                 # Плагин для text-to-speech
        ├── plugin.cfg
        ├── tts.py
        └── rq.txt
```

## Как работает система плагинов

### 1. Автоматическая загрузка

При запуске сервера система автоматически:
- Сканирует директорию `plugin/`
- Ищет поддиректории с файлом `plugin.cfg`
- Загружает и регистрирует каждый плагин

### 2. Конфигурация плагина (plugin.cfg)

Каждый плагин должен содержать файл `plugin.cfg` с следующими параметрами:

```ini
plugin_name = Название плагина
plugin_version = 1.0.0
plugin_author = Автор
plugin_description = Описание функциональности
plugin_url = https://example.com
plugin_license = MIT
plugin_dependencies = requirements.txt
plugin_main_file = main.py
```

### 3. Основной файл плагина

Основной файл плагина должен содержать функцию регистрации маршрутов:

```python
def register_[plugin_name]_routes(app: FastAPI):
    \"\"\"Регистрация маршрутов плагина\"\"\"
    
    @app.get("/plugin-route")
    async def plugin_handler():
        return {"message": "Plugin working"}
```

## Загруженные плагины

### GitHub Plugin
- **Описание**: Плагин для работы с GitHub репозиториями и CDN функциональностью
- **Маршруты**: `/{file_path:path}` - проксирование файлов из GitHub
- **Функции**: 
  - Потоковая передача файлов
  - Поддержка видео/аудио с диапазонами
  - Обработка HLS (.m3u8/.ts)
  - Автоматическое определение MIME типов

### ILL Plugin
- **Описание**: Плагин для работы с .ill архивами
- **Маршруты**: `/ill/{file_path:path}` - обработка .ill файлов
- **Функции**:
  - Парсинг манифестов .ill
  - Сборка частей .illg
  - Потоковая передача больших файлов

### TTS Plugin
- **Описание**: Плагин для преобразования текста в речь
- **Маршруты**: `/tts?content=текст&viev` - генерация аудио
- **Функции**:
  - Использование edge-tts
  - Потоковая передача аудио
  - Поддержка русского языка

## API эндпоинты

### Информация о плагинах
```
GET /plugins
```
Возвращает JSON с информацией о всех загруженных плагинах.

### Главная страница
```
GET /
```
Отображает HTML страницу с информацией о сервере и загруженных плагинах.

## Запуск сервера

```bash
python3 server.py
```

Сервер запустится на `http://0.0.0.0:8000` и автоматически загрузит все плагины.

## Создание нового плагина

1. Создайте директорию в `plugin/`
2. Добавьте файл `plugin.cfg` с конфигурацией
3. Создайте основной файл плагина с функцией регистрации
4. Перезапустите сервер

Пример структуры нового плагина:
```
plugin/MyPlugin/
├── plugin.cfg
├── myplugin.py
└── requirements.txt (опционально)
```

## Зависимости

Основные зависимости:
- fastapi
- uvicorn
- requests
- edge-tts (для TTS плагина)

Установка:
```bash
pip3 install fastapi uvicorn requests edge-tts
```

## Особенности

- Плагины загружаются динамически при старте
- Поддержка CORS для всех маршрутов
- Автоматическое определение функций регистрации
- Обработка ошибок при загрузке плагинов
- Информация о плагинах доступна через API

